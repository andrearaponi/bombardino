# Tutorial: Testing a CRUD API

This tutorial walks you through testing a complete REST API using all Bombardino features. You'll learn how to test Create, Read, Update, and Delete operations with assertions, variable extraction, and dependencies.

## The API We're Testing

We'll test a Person API with these endpoints:

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/hello` | Health check |
| POST | `/api/persons` | Create a person |
| GET | `/api/persons` | List all persons |
| GET | `/api/persons/{id}` | Get person by ID |
| GET | `/api/persons/by-mail?mail=xxx` | Get person by email |
| PUT | `/api/persons/{id}` | Update a person |
| DELETE | `/api/persons/{id}` | Delete a person |

A person has these fields:
- `id` (generated by server)
- `name` (string)
- `surname` (string)
- `age` (integer)
- `height` (float)
- `weight` (float)
- `mail` (string)

## Step 1: Health Check

Let's start simple. Test that the API is running:

```json
{
  "name": "Step 1: Health Check",
  "global": {
    "base_url": "http://localhost:8080",
    "iterations": 1
  },
  "tests": [
    {
      "name": "Hello Endpoint",
      "method": "GET",
      "path": "/hello",
      "expected_status": [200],
      "assertions": [
        {
          "type": "status",
          "target": "response",
          "operator": "eq",
          "value": 200
        },
        {
          "type": "response_time",
          "target": "response",
          "operator": "lt",
          "value": "1s"
        }
      ]
    }
  ]
}
```

Run it:
```bash
bombardino -config step1.json
```

**What we learned:**
- Basic test structure
- Status code assertion
- Response time assertion

## Step 2: Create a Person

Now let's create a person and validate the response:

```json
{
  "name": "Step 2: Create Person",
  "global": {
    "base_url": "http://localhost:8080",
    "iterations": 1,
    "headers": {
      "Content-Type": "application/json"
    }
  },
  "tests": [
    {
      "name": "Create Person",
      "method": "POST",
      "path": "/api/persons",
      "expected_status": [201],
      "body": {
        "name": "Mario",
        "surname": "Rossi",
        "age": 30,
        "height": 175.5,
        "weight": 75.0,
        "mail": "mario.rossi@test.com"
      },
      "assertions": [
        {
          "type": "status",
          "target": "response",
          "operator": "eq",
          "value": 201
        },
        {
          "type": "json_path",
          "target": "id",
          "operator": "exists",
          "value": ""
        },
        {
          "type": "json_path",
          "target": "name",
          "operator": "eq",
          "value": "Mario"
        },
        {
          "type": "json_path",
          "target": "surname",
          "operator": "eq",
          "value": "Rossi"
        },
        {
          "type": "json_path",
          "target": "age",
          "operator": "eq",
          "value": 30
        }
      ],
      "extract": [
        {"name": "person_id", "source": "body", "path": "id"},
        {"name": "person_email", "source": "body", "path": "mail"}
      ]
    }
  ]
}
```

**What we learned:**
- POST request with JSON body
- Multiple JSON path assertions
- Extracting values for later use

## Step 3: Read Operations

Use the extracted ID to read the person:

```json
{
  "name": "Step 3: Read Person",
  "global": {
    "base_url": "http://localhost:8080",
    "iterations": 1,
    "headers": {
      "Content-Type": "application/json"
    }
  },
  "tests": [
    {
      "name": "Create Person",
      "method": "POST",
      "path": "/api/persons",
      "expected_status": [201],
      "body": {
        "name": "Mario",
        "surname": "Rossi",
        "age": 30,
        "mail": "mario.rossi@test.com"
      },
      "extract": [
        {"name": "person_id", "source": "body", "path": "id"},
        {"name": "person_email", "source": "body", "path": "mail"}
      ]
    },
    {
      "name": "Get Person by ID",
      "method": "GET",
      "path": "/api/persons/${person_id}",
      "expected_status": [200],
      "depends_on": ["Create Person"],
      "assertions": [
        {
          "type": "json_path",
          "target": "name",
          "operator": "eq",
          "value": "Mario"
        }
      ]
    },
    {
      "name": "Get Person by Email",
      "method": "GET",
      "path": "/api/persons/by-mail?mail=${person_email}",
      "expected_status": [200],
      "depends_on": ["Create Person"],
      "assertions": [
        {
          "type": "json_path",
          "target": "mail",
          "operator": "contains",
          "value": "@test.com"
        }
      ]
    }
  ]
}
```

**What we learned:**
- Using `${variable}` in paths and query strings
- `depends_on` for test ordering
- Parallel execution (both GET tests run after Create)

## Step 4: Update Operation

Update the person we created:

```json
{
  "name": "Update Person",
  "method": "PUT",
  "path": "/api/persons/${person_id}",
  "expected_status": [200],
  "depends_on": ["Get Person by ID"],
  "body": {
    "name": "Mario",
    "surname": "Rossi-Updated",
    "age": 31,
    "height": 176.0,
    "weight": 76.0,
    "mail": "mario.rossi@test.com"
  },
  "assertions": [
    {
      "type": "json_path",
      "target": "surname",
      "operator": "eq",
      "value": "Rossi-Updated"
    },
    {
      "type": "json_path",
      "target": "age",
      "operator": "eq",
      "value": 31
    }
  ]
}
```

**What we learned:**
- PUT request for updates
- Chaining dependencies (Update after Get)

## Step 5: Delete and Verify

Delete the person and confirm it's gone:

```json
{
  "name": "Delete Person",
  "method": "DELETE",
  "path": "/api/persons/${person_id}",
  "expected_status": [204],
  "depends_on": ["Update Person"]
},
{
  "name": "Verify Deletion",
  "method": "GET",
  "path": "/api/persons/${person_id}",
  "expected_status": [404],
  "depends_on": ["Delete Person"],
  "assertions": [
    {
      "type": "status",
      "target": "response",
      "operator": "eq",
      "value": 404
    }
  ]
}
```

**What we learned:**
- DELETE request
- Testing for 404 (expected failure)
- Full cleanup workflow

## Step 6: Complete Configuration

Here's the full test suite putting it all together:

```json
{
  "name": "Bombardino v1.0.0 Full Feature Test Suite",
  "description": "Complete CRUD test with assertions, chaining, and think time",
  "global": {
    "base_url": "http://localhost:8080",
    "timeout": "30s",
    "delay": "100ms",
    "iterations": 1,
    "think_time_min": "100ms",
    "think_time_max": "300ms",
    "headers": {
      "Content-Type": "application/json"
    }
  },
  "tests": [
    {
      "name": "1. Health Check",
      "description": "Verify server is running",
      "method": "GET",
      "path": "/hello",
      "expected_status": [200],
      "think_time": "50ms",
      "assertions": [
        {"type": "status", "target": "response", "operator": "eq", "value": 200},
        {"type": "response_time", "target": "response", "operator": "lt", "value": "5000ms"}
      ]
    },
    {
      "name": "2. Create Person",
      "description": "Create a new person",
      "method": "POST",
      "path": "/api/persons",
      "expected_status": [201],
      "body": {
        "name": "Mario",
        "surname": "Rossi",
        "age": 30,
        "height": 175.5,
        "weight": 75.0,
        "mail": "mario.rossi@bombardino-test.com"
      },
      "assertions": [
        {"type": "status", "target": "response", "operator": "eq", "value": 201},
        {"type": "json_path", "target": "id", "operator": "exists", "value": ""},
        {"type": "json_path", "target": "name", "operator": "eq", "value": "Mario"},
        {"type": "json_path", "target": "surname", "operator": "eq", "value": "Rossi"},
        {"type": "json_path", "target": "age", "operator": "eq", "value": 30}
      ],
      "extract": [
        {"name": "person_id", "source": "body", "path": "id"},
        {"name": "person_email", "source": "body", "path": "mail"}
      ]
    },
    {
      "name": "3. Get Person by ID",
      "description": "Retrieve person using extracted ID",
      "method": "GET",
      "path": "/api/persons/${person_id}",
      "expected_status": [200],
      "depends_on": ["2. Create Person"],
      "assertions": [
        {"type": "json_path", "target": "id", "operator": "exists", "value": ""},
        {"type": "json_path", "target": "name", "operator": "eq", "value": "Mario"},
        {"type": "response_time", "target": "response", "operator": "lt", "value": "2000ms"}
      ]
    },
    {
      "name": "4. Get Person by Email",
      "description": "Retrieve person using extracted email",
      "method": "GET",
      "path": "/api/persons/by-mail?mail=${person_email}",
      "expected_status": [200],
      "depends_on": ["2. Create Person"],
      "assertions": [
        {"type": "json_path", "target": "mail", "operator": "contains", "value": "bombardino-test.com"}
      ]
    },
    {
      "name": "5. Update Person",
      "description": "Update the person",
      "method": "PUT",
      "path": "/api/persons/${person_id}",
      "expected_status": [200],
      "depends_on": ["3. Get Person by ID"],
      "body": {
        "name": "Mario",
        "surname": "Rossi-Updated",
        "age": 31,
        "height": 176.0,
        "weight": 76.0,
        "mail": "mario.rossi@bombardino-test.com"
      },
      "assertions": [
        {"type": "json_path", "target": "surname", "operator": "eq", "value": "Rossi-Updated"},
        {"type": "json_path", "target": "age", "operator": "eq", "value": 31}
      ]
    },
    {
      "name": "6. Get All Persons",
      "description": "List all persons and verify our person",
      "method": "GET",
      "path": "/api/persons",
      "expected_status": [200],
      "depends_on": ["5. Update Person"],
      "assertions": [
        {"type": "json_path", "target": "0.id", "operator": "exists", "value": ""},
        {"type": "json_path", "target": "0.surname", "operator": "eq", "value": "Rossi-Updated"}
      ]
    },
    {
      "name": "7. Delete Person",
      "description": "Delete the person",
      "method": "DELETE",
      "path": "/api/persons/${person_id}",
      "expected_status": [204],
      "depends_on": ["6. Get All Persons"],
      "think_time": "200ms"
    },
    {
      "name": "8. Verify Deletion",
      "description": "Confirm person no longer exists",
      "method": "GET",
      "path": "/api/persons/${person_id}",
      "expected_status": [404],
      "depends_on": ["7. Delete Person"],
      "assertions": [
        {"type": "status", "target": "response", "operator": "eq", "value": 404},
        {"type": "json_path", "target": "message", "operator": "contains", "value": "not found"}
      ]
    }
  ]
}
```

## Step 7: Running the Tests

### Text Output

```bash
bombardino -config full-feature-test.json
```

Expected output:
```
╔════════════════════════════════════════════════════════════════╗
║                        TEST SUMMARY                            ║
╚════════════════════════════════════════════════════════════════╝

Total Requests:     8
Successful:         8 (100.0%)
Failed:             0 (0.0%)

╔════════════════════════════════════════════════════════════════╗
║                        ASSERTIONS                              ║
╚════════════════════════════════════════════════════════════════╝

Total: 17    Passed: 17    Failed: 0
```

### Verbose Mode

See every request and response:
```bash
bombardino -config full-feature-test.json -verbose
```

### HTML Report

Generate a visual report:
```bash
bombardino -config full-feature-test.json -output html > report.html
open report.html
```

### JSON for CI/CD

Get machine-readable results:
```bash
bombardino -config full-feature-test.json -output json > results.json
echo "Exit code: $?"
```

## Understanding the Execution Order

With dependencies, tests run in phases:

```
Phase 1: 1. Health Check (no dependencies)
    ↓
Phase 2: 2. Create Person (no dependencies)
    ↓
Phase 3: 3. Get Person by ID + 4. Get Person by Email (parallel)
    ↓
Phase 4: 5. Update Person
    ↓
Phase 5: 6. Get All Persons
    ↓
Phase 6: 7. Delete Person
    ↓
Phase 7: 8. Verify Deletion
```

Tests 3 and 4 run in parallel because they both only depend on test 2.

## Data-Driven Variant

Test with multiple persons:

```json
{
  "name": "Create Multiple Persons",
  "method": "POST",
  "path": "/api/persons",
  "expected_status": [201],
  "data": [
    {"name": "Luigi", "surname": "Verdi", "age": 25, "mail": "luigi@test.com"},
    {"name": "Anna", "surname": "Bianchi", "age": 28, "mail": "anna@test.com"},
    {"name": "Paolo", "surname": "Neri", "age": 35, "mail": "paolo@test.com"}
  ],
  "body": {
    "name": "${data.name}",
    "surname": "${data.surname}",
    "age": "${data.age}",
    "mail": "${data.mail}"
  },
  "assertions": [
    {"type": "status", "target": "response", "operator": "eq", "value": 201},
    {"type": "json_path", "target": "id", "operator": "exists", "value": ""}
  ]
}
```

This creates 3 persons in 3 requests.

## Tips for Real-World Testing

1. **Clean up after tests**: Always delete created resources
2. **Use unique emails**: Include timestamps or UUIDs to avoid conflicts
3. **Add realistic think time**: For load testing, simulate real user behavior
4. **Test error cases**: Include tests for 400, 404, 500 responses
5. **Use descriptive names**: "Create Person" is clearer than "Test 1"
6. **Add response time assertions**: Catch performance regressions

## Next Steps

- [Configuration Reference](configuration-reference.md) - All options explained
- [Assertions](assertions.md) - More assertion examples
- [Data-Driven Testing](data-driven-testing.md) - Test with multiple data sets
- [Output Formats](output-formats.md) - CI/CD integration
